<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üì∞ ƒê·ªçc b√°o t·ªïng h·ª£p</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f9f9f9;
      color: #333;
    }
    header {
      background: #1e88e5;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    .buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px;
    }
    .buttons button {
      padding: 10px 20px;
      border: none;
      background: #0288d1;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .buttons button:hover {
      background: #01579b;
    }
    .countdown {
      text-align: center;
      font-size: 14px;
      margin: 5px;
      color: #777;
    }
    .article {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      animation: fadeIn 0.4s ease;
    }
    .article img {
      max-width: 100%;
      height: auto;
      margin: 10px 0;
      border-radius: 6px;
    }
    .article p {
      line-height: 1.6;
      margin-bottom: 12px;
    }
    .next-btn {
      display: block;
      margin: 20px auto;
      padding: 10px 16px;
      background: #43a047;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .next-btn:hover {
      background: #2e7d32;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

  <header>
    <h1>üóûÔ∏è Tin t·ª©c t·ªïng h·ª£p</h1>
    <p class="countdown">T·ª± ƒë·ªông l√†m m·ªõi sau: <span id="timer">--:--</span></p>
  </header>

  <div class="buttons">
    <button onclick="setSource('vnexpress')">VnExpress</button>
    <button onclick="setSource('tuoitre')">Tu·ªïi Tr·∫ª</button>
    <button onclick="setSource('thanhnien')">Thanh Ni√™n</button>
  </div>

  <div id="news-content">ƒêang t·∫£i...</div>
  <button class="next-btn" onclick="loadNext()">‚ñ∂Ô∏è Xem b√†i ti·∫øp theo</button>

  <script>
    const sources = {
      vnexpress: "https://vnexpress.net/rss/tin-moi-nhat.rss",
      tuoitre: "https://tuoitre.vn/rss/tin-moi-nhat.rss",
      thanhnien: "https://thanhnien.vn/rss/home.rss"
    };

    const webAppUrl = "https://script.google.com/macros/s/AKfycbzCPIQa9FR-SUxMdlEslE8GVzsdnYhcwMVY1HUgT-XKzdTXMnUMu5cNa-RVmffEJUsl/exec";

    let currentSource = "vnexpress";
    let articles = [];
    let index = 0;
    let countdown = 1800; // 30 ph√∫t

    async function setSource(sourceKey) {
      currentSource = sourceKey;
      index = 0;
      await fetchRSS();
      showArticle();
      resetTimer();
    }

    async function fetchRSS() {
      const rssUrl = sources[currentSource];
      try {
        const res = await fetch("https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(rssUrl));
        const data = await res.json();

        if (!data.items || data.items.length === 0) {
          throw new Error("Kh√¥ng c√≥ d·ªØ li·ªáu.");
        }

        articles = data.items;
      } catch (err) {
        document.getElementById("news-content").innerHTML = `
          <div class="article">
            <p>‚ùå Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu t·ª´ ngu·ªìn "${currentSource}".</p>
          </div>`;
        articles = [];
      }
    }

    async function showArticle() {
      if (articles.length === 0) return;

      const article = articles[index];
      if (!article) return;

      const url = article.link;
      let content = '<p>‚ùå Kh√¥ng t√¨m th·∫•y n·ªôi dung b√†i vi·∫øt.</p>';

      try {
        const res = await fetch(`${webAppUrl}?url=${encodeURIComponent(url)}`);
        content = await res.text();
      } catch (err) {
        content = '<p>‚ùå Kh√¥ng th·ªÉ t·∫£i n·ªôi dung t·ª´ m√°y ch·ªß.</p>';
      }

      document.getElementById("news-content").innerHTML = `
        <div class="article">
          <h2>${article.title}</h2>
          <p><em>${new Date(article.pubDate).toLocaleString("vi-VN")}</em></p>
          ${article.thumbnail ? `<img src="${article.thumbnail}" alt="Thumbnail" />` : ""}
          ${content}
          <p><a href="${url}" target="_blank">üîó ƒê·ªçc b√†i g·ªëc</a></p>
        </div>
      `;
    }

    function loadNext() {
      if (articles.length === 0) return;
      index = (index + 1) % articles.length;
      showArticle();
    }

    function resetTimer() {
      countdown = 1800;
    }

    function startTimer() {
      setInterval(() => {
        countdown--;
        const mins = String(Math.floor(countdown / 60)).padStart(2, '0');
        const secs = String(countdown % 60).padStart(2, '0');
        document.getElementById("timer").innerText = `${mins}:${secs}`;
        if (countdown <= 0) {
          setSource(currentSource);
        }
      }, 1000);
    }

    setSource("vnexpress");
    startTimer();
  </script>

</body>
</html>
